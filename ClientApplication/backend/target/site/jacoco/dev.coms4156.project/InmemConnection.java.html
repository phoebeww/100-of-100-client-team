<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InmemConnection.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">backend</a> &gt; <a href="index.source.html" class="el_package">dev.coms4156.project</a> &gt; <span class="el_source">InmemConnection.java</span></div><h1>InmemConnection.java</h1><pre class="source lang-java linenums">package dev.coms4156.project;

import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Provides in-memory data for testing purposes without connecting to a real database.
 */
public class InmemConnection implements DatabaseConnection {
  private static volatile InmemConnection instance;

<span class="fc" id="L15">  private final Map&lt;Integer, List&lt;Employee&gt;&gt; testEmployees = new HashMap&lt;&gt;();</span>
<span class="fc" id="L16">  private final Map&lt;Integer, List&lt;Department&gt;&gt; testDepartments = new HashMap&lt;&gt;();</span>
<span class="fc" id="L17">  private final Map&lt;Integer, Organization&gt; testOrganizations = new HashMap&lt;&gt;();</span>

  public String connectionName() {
<span class="fc" id="L20">    return &quot;In-memory Database::null&quot;;</span>
  }

  /**
   * Constructs a DatabaseConnectionStub and initializes test data.
   */
<span class="fc" id="L26">  private InmemConnection() {</span>
<span class="fc" id="L27">    initializeTestData();</span>
<span class="fc" id="L28">  }</span>

  /**
   * Resets the test data to its initial state.
   * This method should be called before each test to ensure a clean state.
   */
  public void resetTestData() {
<span class="fc" id="L35">    testEmployees.clear();</span>
<span class="fc" id="L36">    testDepartments.clear();</span>
<span class="fc" id="L37">    testOrganizations.clear();</span>
<span class="fc" id="L38">    initializeTestData();</span>
<span class="fc" id="L39">  }</span>

  @Override
  public boolean updateDepartment(int organizationId, Department department) {
<span class="fc" id="L43">    List&lt;Department&gt; departments = testDepartments.get(organizationId);</span>
<span class="pc bpc" id="L44" title="1 of 2 branches missed.">    if (departments == null) {</span>
<span class="nc" id="L45">      return false;</span>
    }

<span class="pc bpc" id="L48" title="1 of 2 branches missed.">    if (department.getHead() != null) {</span>
<span class="fc" id="L49">      Employee head = getEmployee(organizationId, department.getHead().getId());</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">      if (head == null) {</span>
<span class="nc" id="L51">        return false;</span>
      }
    }

<span class="pc bpc" id="L55" title="1 of 2 branches missed.">    for (int i = 0; i &lt; departments.size(); i++) {</span>
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">      if (departments.get(i).getId() == department.getId()) {</span>
<span class="fc" id="L57">        departments.set(i, department);</span>
<span class="fc" id="L58">        return true;</span>
      }
    }
<span class="nc" id="L61">    return false;</span>
  }

  @Override
  public boolean removeDepartment(int organizationId, int externalDepartmentId) {
<span class="nc" id="L66">    return false;</span>
  }

  @Override
  public int addEmployeeToDepartment(int organizationId, int departmentId, Employee employee) {
<span class="fc" id="L71">    List&lt;Employee&gt; employees = testEmployees.get(organizationId);</span>
<span class="fc" id="L72">    List&lt;Department&gt; departments = testDepartments.get(organizationId);</span>

<span class="pc bpc" id="L74" title="2 of 4 branches missed.">    if (employees == null || departments == null) {</span>
<span class="nc" id="L75">      return -1;</span>
    }

<span class="fc" id="L78">    Department targetDept = null;</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">    for (Department dept : departments) {</span>
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">      if (dept.getId() == (departmentId % 10000)) {</span>
<span class="fc" id="L81">        targetDept = dept;</span>
<span class="fc" id="L82">        break;</span>
      }
<span class="nc" id="L84">    }</span>

<span class="pc bpc" id="L86" title="1 of 2 branches missed.">    if (targetDept == null) {</span>
<span class="nc" id="L87">      return -1;</span>
    }

<span class="fc" id="L90">    int maxId = 0;</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">    for (Employee emp : employees) {</span>

<span class="pc bpc" id="L93" title="1 of 2 branches missed.">      if (emp.getId() &gt; maxId) {</span>
<span class="fc" id="L94">        maxId = emp.getId();</span>
      }
<span class="fc" id="L96">    }</span>
<span class="fc" id="L97">    int newEmployeeId = maxId + 1;</span>

<span class="fc" id="L99">    Employee newEmployee = new Employee(newEmployeeId, employee.getName(), employee.getHireDate());</span>
<span class="fc" id="L100">    employees.add(newEmployee);</span>
<span class="fc" id="L101">    targetDept.addEmployee(newEmployee);</span>

<span class="fc" id="L103">    return organizationId * 10000 + newEmployeeId;</span>
  }

  @Override
  public boolean removeEmployeeFromDepartment(
      int organizationId, int departmentId, int employeeId
  ) {
<span class="fc" id="L110">    List&lt;Department&gt; departments = testDepartments.get(organizationId);</span>
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">    if (departments == null) {</span>
<span class="nc" id="L112">      return false;</span>
    }

<span class="fc" id="L115">    int externalDepartmentId = departmentId % 10000;</span>
<span class="fc" id="L116">    int externalEmployeeId = employeeId % 10000;</span>

<span class="fc" id="L118">    Department targetDept = null;</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">    for (Department dept : departments) {</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">      if (dept.getId() == externalDepartmentId) {</span>
<span class="fc" id="L121">        targetDept = dept;</span>
<span class="fc" id="L122">        break;</span>
      }
<span class="nc" id="L124">    }</span>

<span class="pc bpc" id="L126" title="1 of 2 branches missed.">    if (targetDept == null) {</span>
<span class="nc" id="L127">      return false;</span>
    }

<span class="fc" id="L130">    Employee targetEmployee = null;</span>
<span class="fc" id="L131">    List&lt;Employee&gt; employees = testEmployees.get(organizationId);</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">    if (employees != null) {</span>
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">      for (Employee emp : employees) {</span>
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">        if (emp.getId() == externalEmployeeId) {</span>
<span class="fc" id="L135">          targetEmployee = emp;</span>
<span class="fc" id="L136">          break;</span>
        }
<span class="nc" id="L138">      }</span>
    }

<span class="pc bpc" id="L141" title="1 of 2 branches missed.">    if (targetEmployee == null) {</span>
<span class="nc" id="L142">      return false;</span>
    }

<span class="pc bpc" id="L145" title="3 of 4 branches missed.">    if (targetDept.getHead() != null &amp;&amp; targetDept.getHead().getId() == targetEmployee.getId()) {</span>
<span class="nc" id="L146">      targetDept.setHead(null);</span>
    }

<span class="fc" id="L149">    boolean employeeRemoved = employees.remove(targetEmployee);</span>

<span class="fc" id="L151">    boolean deptRemoved = false;</span>
<span class="fc" id="L152">    List&lt;Employee&gt; deptEmployees = targetDept.getEmployees();</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">    if (deptEmployees != null) {</span>
<span class="fc" id="L154">      deptRemoved = deptEmployees.remove(targetEmployee);</span>
    }

<span class="pc bpc" id="L157" title="2 of 4 branches missed.">    return employeeRemoved &amp;&amp; deptRemoved;</span>
  }

  @Override
  public Department insertDepartment(int organizationId, Department department) {
<span class="nc" id="L162">    return null;</span>
  }
  
  /**
   * Updates an employee's information in the stubbed database for a given organization.
   *
   * @param organizationId the organization ID (client ID)
   * @param employee the {@code Employee} object containing the updated information
   * @return {@code true} if the employee was found and updated; {@code false} otherwise
   */
  @Override
  public boolean updateEmployee(int organizationId, Employee employee) {
<span class="fc" id="L174">    List&lt;Employee&gt; employees = testEmployees.get(organizationId);</span>
<span class="fc" id="L175">    boolean updated = false;</span>

<span class="pc bpc" id="L177" title="1 of 2 branches missed.">    if (employees != null) {</span>
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">      for (int i = 0; i &lt; employees.size(); i++) {</span>
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">        if (employees.get(i).getId() == employee.getId()) {</span>
<span class="fc" id="L180">          employees.set(i, employee);</span>
<span class="fc" id="L181">          updated = true;</span>
<span class="fc" id="L182">          break;</span>
        }
      }
    }

<span class="pc bpc" id="L187" title="1 of 2 branches missed.">    if (updated) {</span>
      // Update the employee in the departments' employee lists
<span class="fc" id="L189">      List&lt;Department&gt; departments = testDepartments.get(organizationId);</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">      if (departments != null) {</span>
<span class="fc bfc" id="L191" title="All 2 branches covered.">        for (Department dept : departments) {</span>
<span class="fc" id="L192">          List&lt;Employee&gt; deptEmployees = dept.getEmployees();</span>
<span class="pc bpc" id="L193" title="1 of 2 branches missed.">          if (deptEmployees != null) {</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">            for (int i = 0; i &lt; deptEmployees.size(); i++) {</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">              if (deptEmployees.get(i).getId() == employee.getId()) {</span>
<span class="fc" id="L196">                deptEmployees.set(i, employee);</span>
<span class="fc" id="L197">                break;</span>
              }
            }
          }

<span class="fc" id="L202">          Employee head = dept.getHead();</span>
<span class="pc bpc" id="L203" title="3 of 4 branches missed.">          if (head != null &amp;&amp; head.getId() == employee.getId()) {</span>
<span class="nc" id="L204">            dept.setHead(employee);</span>
          }
<span class="fc" id="L206">        }</span>
      }
    }

<span class="fc" id="L210">    return updated;</span>
  }

  /**
   * Retrieves an employee for a given organization by external employee ID.
   *
   * @param organizationId the organization ID (client ID)
   * @param externalEmployeeId the external employee ID
   * @return the Employee object if found, null otherwise
   */
  @Override
  public Employee getEmployee(int organizationId, int externalEmployeeId) {
<span class="fc" id="L222">    List&lt;Employee&gt; employees = testEmployees.get(organizationId);</span>
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">    if (employees != null) {</span>
<span class="pc bpc" id="L224" title="1 of 2 branches missed.">      for (Employee employee : employees) {</span>
<span class="pc bpc" id="L225" title="1 of 2 branches missed.">        if (employee.getId() == externalEmployeeId) {</span>
<span class="fc" id="L226">          return employee;</span>
        }
<span class="nc" id="L228">      }</span>
    }
<span class="nc" id="L230">    return null;</span>
  }

  /**
   * Retrieves a department for a given organization by external department ID.
   *
   * @param organizationId the organization ID (client ID)
   * @param externalDepartmentId the external department ID
   * @return the Department object if found, null otherwise
   */
  @Override
  public Department getDepartment(int organizationId, int externalDepartmentId) {
<span class="nc" id="L242">    List&lt;Department&gt; departments = testDepartments.get(organizationId);</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">    if (departments != null) {</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">      for (Department department : departments) {</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (department.getId() == externalDepartmentId) {</span>
<span class="nc" id="L246">          return department;</span>
        }
<span class="nc" id="L248">      }</span>
    }
<span class="nc" id="L250">    return null;</span>
  }

  /**
   * Retrieves a list of employees for a given organization.
   *
   * @param organizationId the organization ID (client ID)
   * @return a list of Employee objects
   */
  @Override
  public List&lt;Employee&gt; getEmployees(int organizationId) {
<span class="fc" id="L261">    return testEmployees.getOrDefault(organizationId, new ArrayList&lt;&gt;());</span>
  }

  /**
   * Retrieves a list of departments for a given organization.
   *
   * @param organizationId the organization ID (client ID)
   * @return a list of Department objects
   */
  @Override
  public List&lt;Department&gt; getDepartments(int organizationId) {
<span class="fc" id="L272">    return testDepartments.getOrDefault(organizationId, new ArrayList&lt;&gt;());</span>
  }

  /**
   * Retrieves the organization for a given organization ID.
   *
   * @param organizationId the organization ID (client ID)
   * @return the Organization object
   */
  @Override
  public Organization getOrganization(int organizationId) {
<span class="fc" id="L283">    return testOrganizations.getOrDefault(organizationId, null);</span>
  }

  @Override
  public boolean updateOrganization(Organization organization) {
<span class="nc" id="L288">    return false;</span>
  }

  @Override
  public boolean removeOrganization(int organizationId) {
<span class="nc" id="L293">    return false;</span>
  }

  /**
   * Retrieves the organization for a given organization name.
   *
   * @param organization the organization object that contains the name
   * @return the correct Organization object
   */
  @Override
  public Organization insertOrganization(Organization organization) {
    // Get the maximum ID to generate a new ID
<span class="fc" id="L305">    int maxId = 0;</span>
<span class="fc bfc" id="L306" title="All 2 branches covered.">    for (int id : testOrganizations.keySet()) {</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">      if (id &gt; maxId) {</span>
<span class="fc" id="L308">        maxId = id;</span>
      }
<span class="fc" id="L310">    }</span>
<span class="fc" id="L311">    int newId = maxId + 1;</span>
    // Create a new organization with the new ID
<span class="fc" id="L313">    Organization newOrganization = new Organization(newId, organization.getName());</span>
<span class="fc" id="L314">    testOrganizations.put(newId, newOrganization);</span>
<span class="fc" id="L315">    return newOrganization;</span>
  }

  /** Initializes the test data for the stub. */
  private void initializeTestData() {
    // Client 1 Data
<span class="fc" id="L321">    int clientId1 = 1;</span>

    // Departments for Client 1
<span class="fc" id="L324">    Department engineering1 = new Department(1, &quot;Engineering&quot;, new ArrayList&lt;&gt;());</span>
<span class="fc" id="L325">    Department marketing1 = new Department(2, &quot;Marketing&quot;, new ArrayList&lt;&gt;());</span>

    // Employees for Client 1
<span class="fc" id="L328">    Employee johnDoe = new Employee(</span>
        1, &quot;John Doe&quot;, new Date(), &quot;SoftwareEngineer&quot;, 100, 80
    );
<span class="fc" id="L331">    Employee janeSmith = new Employee(2, &quot;Jane Smith&quot;, new Date());</span>

    // Add employees to departments for Client 1
<span class="fc" id="L334">    engineering1.addEmployee(johnDoe);</span>
<span class="fc" id="L335">    marketing1.addEmployee(janeSmith);</span>

    // Organization for Client 1
<span class="fc" id="L338">    Organization organization1 = new Organization(clientId1, &quot;Organization One&quot;);</span>
<span class="fc" id="L339">    organization1.addDepartment(engineering1);</span>
<span class="fc" id="L340">    organization1.addDepartment(marketing1);</span>

    // Store data for Client 1
<span class="fc" id="L343">    testEmployees.put(clientId1, new ArrayList&lt;&gt;(List.of(johnDoe, janeSmith)));</span>
<span class="fc" id="L344">    testDepartments.put(clientId1, new ArrayList&lt;&gt;(List.of(engineering1, marketing1)));</span>
<span class="fc" id="L345">    testOrganizations.put(clientId1, organization1);</span>

    // Client 2 Data
<span class="fc" id="L348">    int clientId2 = 2;</span>

    // Departments for Client 2
<span class="fc" id="L351">    Department engineering2 = new Department(1, &quot;Engineering&quot;, new ArrayList&lt;&gt;());</span>
<span class="fc" id="L352">    Department marketing2 = new Department(2, &quot;Marketing&quot;, new ArrayList&lt;&gt;());</span>

    // Employees for Client 2
<span class="fc" id="L355">    Employee aliceJohnson = new Employee(1, &quot;Alice Johnson&quot;, new Date());</span>
<span class="fc" id="L356">    Employee bobBrown = new Employee(</span>
        2, &quot;Bob Brown&quot;, new Date(), &quot;ProductManager&quot;, 200, 99
    );

    // Add employees to departments for Client 2
<span class="fc" id="L361">    engineering2.addEmployee(aliceJohnson);</span>
<span class="fc" id="L362">    marketing2.addEmployee(bobBrown);</span>

    // Organization for Client 2
<span class="fc" id="L365">    Organization organization2 = new Organization(clientId2, &quot;Organization Two&quot;);</span>
<span class="fc" id="L366">    organization2.addDepartment(engineering2);</span>
<span class="fc" id="L367">    organization2.addDepartment(marketing2);</span>

    // Store data for Client 2
<span class="fc" id="L370">    testEmployees.put(clientId2, new ArrayList&lt;&gt;(List.of(aliceJohnson, bobBrown)));</span>
<span class="fc" id="L371">    testDepartments.put(clientId2, new ArrayList&lt;&gt;(List.of(engineering2, marketing2)));</span>
<span class="fc" id="L372">    testOrganizations.put(clientId2, organization2);</span>
<span class="fc" id="L373">  }</span>

  /**
   * Returns the unique instance of the database connection.
   * Designed with &quot;double-checked locking&quot; mechanism to ensure thread safety.
   *
   * @return the database connection instance
   */
  public static InmemConnection getInstance() {
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">    if (instance == null) {</span>
<span class="fc" id="L383">      synchronized (InmemConnection.class) {</span>
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">        if (instance == null) {</span>
<span class="fc" id="L385">          instance = new InmemConnection();</span>
        }
<span class="fc" id="L387">      }</span>
    }
<span class="fc" id="L389">    return instance;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>